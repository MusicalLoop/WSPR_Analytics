{% extends "base.html" %}
{% import "_macros.html" as macros %} {# Import the macro file #}

{% block content %}
<h2>Analysis</h2>
{% if error %}
  <div class="alert alert-danger">{{ error }}</div>
{% else %}
  <!-- Summary Statistics Card (Improved) -->
  <div class="card mb-4 shadow-sm">
      <div class="card-header">
          <h4 class="mb-0">Overview Statistics</h4>
      </div>
      <div class="card-body">
          <dl class="row mb-0"> {# Using a definition list for key-value pairs #}
              {% for metric in summaryData %}
              <dt class="col-sm-8">{{ metric.label }}:</dt>
              <dd class="col-sm-4 text-end"><span class="badge bg-primary fs-6">{{ metric.value }}</span></dd>
              {% endfor %}
          </dl>
      </div>
  </div>


  <div class="row">
    <div class="col-md-6 mb-4">
        <!-- Average Distanace and spots per hour -->
        {{ macros.render_table_card(title="WSPR Distance Analysis per Hour", caption="WSPR distance analysis per hour per day.", headers=["Time", "Mean", "Min", "Max", "Spots"], rows=hourlyList, time_format="%d-%m-%Y %H:%M") }}
    </div>

    <div class="col-md-6 mb-4">
        <!-- Top Call Signs Card -->
        {{ macros.render_table_card( title="Top Call Signs by Frequency (" ~ callSignList|length ~ ")", caption="Most frequently spotted WSPR call signs.", headers=["Call Sign", "Count", "Grid"], rows=callSignList) }}
    </div>
  </div>


  <!-- Furthest Stations and Countries in one row -->
  <div class="row">
      <div class="col-md-6 mb-4">
          <!-- Furthest Stations Card -->
          {{ macros.render_table_card( title="Furthest Stations by Distance (" ~ distanceList|length ~ ")", caption="WSPR stations received from the greatest distances.", headers=["Call Sign", "Distance (km)", "Grid", "Count"], rows=distanceList ) }}
      </div>

      <div class="col-md-6 mb-4">
          <!-- Countries by Spot Count Card -->
          {{ macros.render_table_card( title="Countries by Spot Count", caption="WSPR spot counts grouped by originating country.", headers=["Country", "Spots"], rows=countryList ) }}
      </div>
  </div>

  <div class="row">
      <div class="col-md-6 mb-4">
          <!-- Distance Distribution Card -->
          {{ macros.render_table_card( title="Distance Distribution", caption="Distribution of WSPR spots across different distance ranges.", headers=["Distance Range", "Number of Spots"], rows=distanceBinList ) }}
      </div>
  </div>

{% endif %}
{% endblock %}
